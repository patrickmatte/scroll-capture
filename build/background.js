(()=>{"use strict";let e="<measurement_id>",t="<api_secret>";const a=new class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.debug=e}async getOrCreateClientId(){let{clientId:e}=await chrome.storage.local.get("clientId");return e||(e=self.crypto.randomUUID(),await chrome.storage.local.set({clientId:e})),e}async getOrCreateSessionId(){let{sessionData:e}=await chrome.storage.session.get("sessionData");const t=Date.now();if(e&&e.timestamp){(t-e.timestamp)/6e4>30?e=null:(e.timestamp=t,await chrome.storage.session.set({sessionData:e}))}return e||(e={session_id:t.toString(),timestamp:t.toString()},await chrome.storage.session.set({sessionData:e})),e.session_id}async fireEvent(a){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};s.session_id||(s.session_id=await this.getOrCreateSessionId()),s.engagement_time_msec||(s.engagement_time_msec=100);try{const r=await fetch(`${this.debug?"https://www.google-analytics.com/debug/mp/collect":"https://www.google-analytics.com/mp/collect"}?measurement_id=${e}&api_secret=${t}`,{method:"POST",body:JSON.stringify({client_id:await this.getOrCreateClientId(),events:[{name:a,params:s}]})});if(!this.debug)return;console.log(await r.text())}catch(e){console.error("Google Analytics request failed with an exception",e)}}async firePageViewEvent(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.fireEvent("page_view",{page_title:e,page_location:t,...a})}async fireErrorEvent(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.fireEvent("extension_error",{...e,...t})}};function s(e,t,a){n(a).then((()=>{chrome.runtime.getContexts({}).then((e=>{const t=e.find((e=>"OFFSCREEN_DOCUMENT"===e.contextType)).documentUrl.endsWith("#recording");chrome.tabs.sendMessage(a.id,{type:"scrollCaptureLocation",location:t?"record":"play"})}))}))}function r(e,t,a){chrome.storage.local.get("tabId").then((t=>{t.tabId==e&&n(a).then((()=>{o(a.id)}))}))}function o(e){chrome.storage.local.get(["defaultLocation"]).then((t=>{const a=t.defaultLocation||"scroll-capture";chrome.tabs.sendMessage(e,{type:"scrollCaptureLocation",location:a})}))}function n(e){return chrome.scripting.executeScript({target:{tabId:e.id},files:["content.js"]})}function i(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";chrome.action.setIcon({path:{16:chrome.runtime.getURL("assets/images/get_started16"+e+".png"),32:chrome.runtime.getURL("assets/images/get_started32"+e+".png"),48:chrome.runtime.getURL("assets/images/get_started48"+e+".png"),128:chrome.runtime.getURL("assets/images/get_started128"+e+".png")}})}e="G-7064XKF42S",t="oNskEvShRDGc0FL2AXyoVQ",chrome.action.onClicked.addListener((async e=>{chrome.storage.local.set({tabId:e.id});const t=await chrome.runtime.getContexts({});let a=!1;const s=t.find((e=>"OFFSCREEN_DOCUMENT"===e.contextType));s?a=s.documentUrl.endsWith("#recording"):await chrome.offscreen.createDocument({url:"offscreen.html",reasons:["USER_MEDIA"],justification:"Recording from chrome.tabCapture API"}),n(e).then((()=>{a?chrome.tabs.sendMessage(e.id,{type:"scrollCaptureLocation",location:"stop"}):(i(""),o(e.id))}))})),chrome.runtime.onMessage.addListener(((e,t,o)=>{switch(e.type){case"scrollCaptureStartRecording":!async function(e){i("_red");const t=await chrome.tabCapture.getMediaStreamId({targetTabId:e.tabId}),a=Object.assign({},e);Object.assign(a,{type:"scrollCaptureStartOffscreenRecording",target:"offscreen",streamId:t}),chrome.runtime.sendMessage(a)}(e);break;case"scrollCaptureStopRecording":i(),chrome.runtime.sendMessage({type:"scrollCaptureStopOffscreenRecording",target:"offscreen"});break;case"scrollCaptureResizeWindow":!function(e,t){let a={width:e,height:t};chrome.windows.getCurrent({populate:!1},(e=>{chrome.windows.update(e.id,a)}))}(e.width,e.height);break;case"scrollCaptureTrackEvent":a.fireEvent(e.category,{action:e.action,label:e.label});break;case"scrollCaptureTrackPage":a.firePageViewEvent(e.path.split("/").pop(),e.path);break;case"scrollCaptureUpdatedTabListener":let t;t="scenario"===e.location?r:s,e.enabled?chrome.tabs.onUpdated.addListener(t):chrome.tabs.onUpdated.removeListener(t);break;case"scrollCaptureInsertCSS":chrome.storage.local.get("tabId").then((t=>{chrome.scripting.insertCSS({target:{tabId:t.tabId},css:e.css})}));break;case"scrollCaptureVisibleTab":chrome.tabs.captureVisibleTab(null,{},(e=>{o({dataUrl:e})}))}return!0}))})();