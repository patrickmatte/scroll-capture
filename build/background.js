(()=>{"use strict";let e="<measurement_id>",t="<api_secret>";const s=new class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.debug=e}async getOrCreateClientId(){let{clientId:e}=await chrome.storage.local.get("clientId");return e||(e=self.crypto.randomUUID(),await chrome.storage.local.set({clientId:e})),e}async getOrCreateSessionId(){let{sessionData:e}=await chrome.storage.session.get("sessionData");const t=Date.now();if(e&&e.timestamp){(t-e.timestamp)/6e4>30?e=null:(e.timestamp=t,await chrome.storage.session.set({sessionData:e}))}return e||(e={session_id:t.toString(),timestamp:t.toString()},await chrome.storage.session.set({sessionData:e})),e.session_id}async fireEvent(s){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};a.session_id||(a.session_id=await this.getOrCreateSessionId()),a.engagement_time_msec||(a.engagement_time_msec=100);try{const r=await fetch(`${this.debug?"https://www.google-analytics.com/debug/mp/collect":"https://www.google-analytics.com/mp/collect"}?measurement_id=${e}&api_secret=${t}`,{method:"POST",body:JSON.stringify({client_id:await this.getOrCreateClientId(),events:[{name:s,params:a}]})});if(!this.debug)return;console.log(await r.text())}catch(e){console.error("Google Analytics request failed with an exception",e)}}async firePageViewEvent(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.fireEvent("page_view",{page_title:e,page_location:t,...s})}async fireErrorEvent(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.fireEvent("extension_error",{...e,...t})}};function a(e,t,s){r(s.id).then((()=>{chrome.runtime.getContexts({}).then((e=>{const t=e.find((e=>"OFFSCREEN_DOCUMENT"===e.contextType)).documentUrl.endsWith("#recording");chrome.tabs.sendMessage(s.id,{type:"scrollCaptureLocation",location:t?"record":"play"})}))}))}function r(e){return chrome.scripting.executeScript({target:{tabId:e},files:["content.js"]})}function o(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";chrome.action.setIcon({path:{16:chrome.runtime.getURL("assets/images/get_started16"+e+".png"),32:chrome.runtime.getURL("assets/images/get_started32"+e+".png"),48:chrome.runtime.getURL("assets/images/get_started48"+e+".png"),128:chrome.runtime.getURL("assets/images/get_started128"+e+".png")}})}e="G-7064XKF42S",t="oNskEvShRDGc0FL2AXyoVQ",chrome.action.onClicked.addListener((async e=>{chrome.storage.local.set({tabId:e.id});const t=await chrome.runtime.getContexts({});let s=!1;const a=t.find((e=>"OFFSCREEN_DOCUMENT"===e.contextType));a?s=a.documentUrl.endsWith("#recording"):await chrome.offscreen.createDocument({url:"offscreen.html",reasons:["USER_MEDIA"],justification:"Recording from chrome.tabCapture API"}),chrome.windows.getCurrent({populate:!1},(t=>{globalThis.chromeSize={width:t.width-e.width,height:t.height-e.height}})),r(e.id).then((()=>{s?chrome.tabs.sendMessage(e.id,{type:"scrollCaptureLocation",location:"stop"}):(o(""),chrome.tabs.sendMessage(e.id,{type:"scrollCaptureLocation",location:""}))}))})),chrome.runtime.onMessage.addListener(((e,t,r)=>{switch(e.type){case"scrollCaptureStartRecording":!async function(e){o("_red");const t=await chrome.tabCapture.getMediaStreamId({targetTabId:e.tabId}),s=Object.assign({},e);Object.assign(s,{type:"scrollCaptureStartOffscreenRecording",target:"offscreen",streamId:t}),chrome.runtime.sendMessage(s)}(e);break;case"scrollCaptureStopRecording":o(),chrome.runtime.sendMessage({type:"scrollCaptureStopOffscreenRecording",target:"offscreen"});break;case"scrollCaptureResizeWindow":!function(e,t){let s={width:e+globalThis.chromeSize.width,height:t+globalThis.chromeSize.height};chrome.windows.getCurrent({populate:!1},(e=>{chrome.windows.update(e.id,s)}))}(e.width,e.height);break;case"scrollCaptureTrackEvent":s.fireEvent(e.category,{action:e.action,label:e.label});break;case"scrollCaptureTrackPage":s.firePageViewEvent(e.path.split("/").pop(),e.path);break;case"scrollCaptureUpdatedTabListener":e.enabled?chrome.tabs.onUpdated.addListener(a):chrome.tabs.onUpdated.removeListener(a)}}))})();